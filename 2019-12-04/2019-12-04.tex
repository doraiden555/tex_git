%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ロボティクス研  研究報告用TEXファイル  前刷り　（旧田中研フォーマットベース）
%  Resume.tex
%
%  2003.03.14	T.Koyama
%  2005.04.11	H.Ohtake
%  2016.03.24	Y.Higashi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper]{jarticle}
\usepackage{Resume}
\usepackage[dvipdfmx]{color,graphicx}
\usepackage{slashbox}
\usepackage{amsmath}
\usepackage{textgreek}%ギリシャ文字を立てにするパッケージ
\usepackage{nidanfloat}%横長の図を1ページ内にうまく挿入する

%本文圧縮コマンド(本文参照)
%\renewcommand{\baselinestretch}{0.75}

\begin{document}
\twocolumn[
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  タイトル・氏名
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\vspace*{10mm}
\begin{center}
	{\Large \gt 2019/12/04 飛翔ロボットミーティング} \\
\end{center}
\begin{flushright}
\begin{tabular}{c@{~}r}
機械設計学専攻	& ロボティクス研究室	\\
18623117		& 中村　翔太		\\
\end{tabular}
\end{flushright}
\vspace{1em}
]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  本文
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{位置制御プログラムの大まかな完成}
以前よりカルマンフィルタにオプティカルフローセンサから得た値も組み込むことにより，位置推定値の精度が向上したといった結果を得ているが，その推定方法を用いたクアッドの位置制御用のプログラムを書いた．大まかには完成したが，以前に位置制御実験を行った際に比べ，機体のパラメータ（重量，スラスト，応答性）や位置推定方法が変わっているので位置制御用のPIDゲインは以前に比べ小さな値から始めようと考えている．


\section{分散値を調整してのカルマンフィルタのシミュレーション}
今までは推定した位置座標を基にクアッドの位置をリアルタイムで制御する必要があるため，カルマンフィルタはオンボードのRaspberry Pi上でリアルタイムで計算していた．しかし，同一の実験試行時における，センサの種類や分散の値を変更した際のフィルタリング結果をオフラインでシミュレーションする必要があるため，matlabを用いてカルマンフィルタを計算可能な環境を構築した．また，その際，全てのセンサ値がカルマンフィルタの計算に必要なため，Raspberry Pi側のプログラムも改め，加速度センサ，ジャイロセンサの値もロギングするようにした．次のfig. 1に分散を[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.01, 0.0006]とした際のUWB+IMU+Optにより推定した結果，[加速度センサ, UWB] = [0.4, 0.02]と設定した際のUWB+IMUにより推定した結果，オプティカルフローセンサを単純積分した結果を合わせて示す．なお，加速度センサ$x, y, z$の3軸，UWBアンカーの4つ，オプティカルフローセンサの$x$軸方向推定速度，$y$軸方向推定速度とそれぞれセンサは複数のセンサ値を持つが，全て同様の分散値を設定している．

\begin{figure}[htbp]
  \begin{center}
     \includegraphics[width=1\linewidth]{./figure/result1.png}
     \caption{[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.01, 0.0006]とした際の推定結果}
     \label{}
  \end{center}
\end{figure}

この結果は同一の試行時のデータを基に推定に組み込むセンサの種類を変えた結果である．オレンジ色のUWB+IMU+Optの計算における分散の決め方はシミュレーションにおいて，定常値がUWBより得た座標と近く，移動中の軌跡が滑らかになるように分散を調整した．それぞれの結果はまず，青色のUWB+IMUにて推定した結果は定常値（ターゲットポイントとなる4点において）それほど大きな分散は見られないが，移動中の軌跡はレーザーポインタが地面の線をトレースするように動かしたにも関わらず，波打っていることが分かる．これの原因はUWBから得られる距離の計測値に分散が乗っており，それが4つのアンカ分相乗するためこういった推定値の分散が生じているためだと考えられる．次にオレンジ色のオプティカルフローセンサ値も参照した結果は定常値は青色の結果と同様に一定の値を取れていることに加え，移動中の軌跡はオプティカルフローセンサの効果により分散値を低く抑えられていることが分かる．ここで$(x, y) = (0, 1)$付近における拡大図を次に示す．



\begin{figure}[htbp]
  \begin{center}
     \includegraphics[width=1\linewidth]{./figure/up.png}
     \caption{fig. 1の$(x, y) = (0, 1)$における拡大図}
     \label{}
  \end{center}
\end{figure}


オプティカルフローセンサを参照した結果，していない結果共に定常値は目標値からおよそ7.6cmほど誤差がある．これの原因はUWBアンカの設置誤差によるものと考えられる．そして，オプティカルフローセンサを参照していない結果は，定常状態においても直径5cmほどの分散が生じているが，参照した結果は定常状態においても分散がなく，曲がり角が綺麗に出ているのが分かる．

次にあえてオプティカルフローセンサの分散よりUWBの分散値を極端に下げてシミュレートした結果をfig. 3に示す．分散は[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.000001, 0.06]である．

\begin{figure}[htbp]
  \begin{center}
     \includegraphics[width=1\linewidth]{./figure/result3.png}
     \caption{[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.01, 0.0006]とした際の推定結果}
     \label{}
  \end{center}
\end{figure}

もう既に他の結果から予想できるが，分散の大きいUWBの値に大きく引っ張られるため，定常値の分散は大きく，軌跡も荒く，ギザギザしたものになる．オプティカルフローセンサの値を参照していないフィルタにおいてもIMUの分散よりUWBの分散を大きく下げると同様の結果を得られた．

最後に分散を[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.1, 0.0006]とオプティカルフローセンサの分散を小さくした際の結果を示す．

\begin{figure}[htbp]
  \begin{center}
     \includegraphics[width=1\linewidth]{./figure/result4.png}
     \caption{[加速度センサ, UWB, オプティカルフローセンサ] = [0.004, 0.1, 0.00006]とした際の推定結果}
     \label{}
  \end{center}
\end{figure}

軌跡や角は滑らかであるが，定常状態における座標がUWBの参照具合を大きくした時よりも大きく右下の方へ外れていることが分かる．この理由はオプティカルフローセンサ成分が強めになったことで推定値の分散は小さくなったが，UWBによる補正が小さくなったため，積分した際のドリフトの影響が大きくなったためであると言える．

これらのシミュレーションでは，今まではRaspberry Piを用いてリアルタイムで計算していた値をオフラインで色々と値を変えながら推定結果を得られるため，このMatlabのカルマンフィルタを作製した意義は大きかったと言える．また，これら3つの結果より，オプティカルフローセンサを今までの推定フィルタに組み込み，適切に分散を調整すれば，定点ホバリング時の推定値の分散が原因のふらつきを抑えることが可能になると考えている．修論の結は今述べたようにオプティカルフローを組み込んだ位置推定，位置制御を用い，定点でのホバリング飛行，3点間を順に移動する飛行制御を行い，ステレオカメラで撮影した真値と比較し，評価することでオプティカルフローセンサを組み込んだことで精度が向上したということで締めたいと現在考えている．

\section{ステレオカメラを用いた画像（動画）の撮影に関して}
以前，瀬戸が脚の角度を解析するのに動画ではなく，画像（jpg）を用いる方法を提言していたが，これからは自身もこの方法を試そうと考えている．というのも以前までは，mp4にて撮影した動画をわざわざ結合し，その後PNGに変換するという作業を行ってから画像解析という手法をとっていた．画像解析自体はそれほど時間はかからないが，結合と画像分割に1分ほどの動画で30分ほど時間を要していた．したがって，最初から画像で撮影し，解析が可能ならかなり時間を削減可能である．．プログラムを修正し，試してみて可能ならこの方法を正式に採用しようと考えている．

\section{今後の予定}

\begin{itemize}
\itemsep=-1ex
  \item 飛行制御の準備
  \item クアッドを飛行させ，ステレオカメラを用いた位置の真値を計測可能かの確認　
\end{itemize}

%\begin{thebibliography}{99}
%\bibitem{1}Pixracer, https://docs.px4.io/v1.9.0/en/flight\_controller/pixracer.html
%\bibitem{2}Servo Gripper, http://ardupilot.org/copter/docs/common-gripper-servo.html
%\bibitem{3}Electro Permanent Magnet Gripper (EPM688), http://ardupilot.org/copter/docs/common-electro-permanent-magnet-gripper.html
%\bibitem{4}Nica Drone, https://nicadrone.com/products/epm-v3
%\end{thebibliography}





%\begin{thebibliography}{1}
%
%\small
%
%\vspace{-2mm}
%\bibitem{1}
%\label{1}
%Krzysztof Cisek，``Ultra-Wide Band Real Time Location Systems: Practical
%Implementation and UAV Performance Evaluation''
%
%%\bibitem{ラベル}
%%著者，
%%題名，
%%誌名＋ページ，
%%年月.
%
%\small
%
%\vspace{-2mm}
%\bibitem{2}
%\label{2}
% M. Pelka, G. Goronzy, and H. Hellbr¨uck, “Iterative approach for
%anchor conﬁguration of positioning systems,” ICT Express, vol. 2,
%no. 1, pp. 1–4, 2016.
%
%
%\small
%
%\vspace{-2mm}
%\bibitem{3}
%\label{3}
%A. Norrdine, “An algebraic solution to the multilateration problem,”
%in Proceedings of the 15th International Conference on Indoor Posi-
%tioning and Indoor Navigation, Sydney, Australia, vol. 1315, 2012.
%
%\end{thebibliography}



%式
%\begin{eqnarray}
%\label{}
%\end{eqnarray}

%\begin{equation}
%\label{}
%\end{equation}

%%箇条書き
%\begin{itemize}
%\itemsep=-1ex
%  \item 
%  \item 
%  \item 
%  \item 
%  \item 
%  \item 
%\end{itemize}

%%図
%\begin{figure}[htbp]
%  \begin{center}
%     \includegraphics[width=1\linewidth]{}
%     \caption{}
%     \label{}
%  \end{center}
%\end{figure}

%%表
%\begin{table}[htbp]
%  \begin{center}
%  \caption{}
%  \label{}
%  \begin{tabular}{|c||c|c|c|}	\hline
%  &&& \\ \hline
%  &&&\\
%  &&&\\ \hline
%  \end{tabular}
%  \end{center}
%\end{table}

%スペースを詰める，あける
%\vspace{-2zh}
%\vspace{2zh}

%  参考文献
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{document}
